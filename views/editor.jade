doctype 5
extends layout
block append head
  link(rel='stylesheet', href='/css/style.css')
  link(rel='stylesheet', href='/css/highlight.css')
  link(rel='stylesheet', href='/css/customized.css')

block append content
  script#dropboxjs(type='text/javascript', src='https://www.dropbox.com/static/api/1/dropins.js', data-app-key='8927n1gidx5s9kr')
  script(src='/components/ckeditor/ckeditor.js', type='text/javascript')
  script(src='/components/ckeditor/adapters/jquery.js', type='text/javascript')
  script(src='//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js')
  script(src='/js/down-and-up.js', type='text/javascript')
  //div(align='center')
  //div(align='container')
  //.container-fluid
  //    .row-fluid
  //        .offset8
  //            input#db-chooser(type='dropbox-chooser', name='selected-file', style='visibility: hidden;')
  //            button#btn_down(type='submit', style='width:50px') down
  //        form
  //            textarea(cols='80', rows='10', id='editor', name='content')
  input#db-chooser(type='dropbox-chooser', name='selected-file', style='visibility: hidden;')
  a.dropbox-saver(href="https://dl.dropboxusercontent.com/u/3968081/DownAndUp.txt", data-filename="DownAndUp.txt");

  button(data-toggle='modal', data-target='#askForTitle') Filename
  #askForTitle.modal.fade(tabindex='-1', role='dialog', aria-labelledby='myModalLabel', aria-hidden='true')
    .modal-dialog
      .modal-content
        .modal-header
          button.close(type='button', data-dismiss='modal', aria-hidden='true') Ã—
          h4#myModalLabel.modal-title Please Enter the File Name:
        .modal-body
          .divDialogElements
          input#modalFilename.xlarge(name='xlInput', type='text', value='DownAndUp')
        .modal-footer
          button#modalCancel.btn.btn-default(type='button', data-dismiss='modal') Cancel
          button#modalOK.btn.btn-primary(type='button') OK


  button#btn_down(type='submit') down
  
  form
      textarea(cols='80', rows='10', id='editor', name='content')

  #display

  script.
      CKEDITOR.replace('editor',{toolbar:'SAMPLE',width:'90%',height:'40%'});
      var strOriginal = decodeURIComponent("!{output}");
      strOriginal = '<pre><code>' + strOriginal + '</code></pre>';
      CKEDITOR.instances.editor.setData(strOriginal);
      var loadUrl = '/down';
      //var up;   // pure text before markdown conversion
      //var down; // markdown-formatted html
      CKEDITOR.config.allowedContent = true;
      var strModified = '';
      var strSent = '';
      $("#btn_down").click(function(){
          if ($("#btn_down").text() == 'down') {
              //console.log($("#btn_down").text());
              $("#btn_down").text('up');
              strModified = CKEDITOR.instances.editor.getSnapshot();
              strSent = strModified.replace(/<pre>/gi, '');
              strSent = strSent.replace(/<code>/gi, '');
              strSent = strSent.replace(/<\/code>/gi, '');
              strSent = strSent.replace(/<\/pre>/gi, '');
              strSent = encodeURIComponent(strSent);
              CKEDITOR.instances.editor.setData('');
              $.post(
                  loadUrl,
                  {source: strSent},
                  function(responseText){
                      responseText = '<pre><code>' + responseText + '</code></pre>';
                      //up = CKEDITOR.instances.editor.getData();
                      //console.log(up)
                      CKEDITOR.instances.editor.setData(responseText);
                      $("#display").html(responseText);
                  },
                  "html"
              );
          }
          else if ($("#btn_down").text() == 'up') {
              $("#btn_down").text('down');
              CKEDITOR.instances.editor.setData(strModified);
              $("#display").html('');
          };
      });
